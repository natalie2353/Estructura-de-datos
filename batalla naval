import string

BOARD_SIZE = 10
LETTERS = string.ascii_uppercase[:BOARD_SIZE]
WATER, SUB, HIT, MISS = "~", "S", "X", "*"

NUM_SUBMARINES = 5

def create_board():
    return [[WATER for _ in range(BOARD_SIZE)] for _ in range(BOARD_SIZE)]

def print_board(board, hide_subs=True):
    header = "   " + " ".join(f"{i:>2}" for i in range(1, BOARD_SIZE+1))
    print(header)
    for r in range(BOARD_SIZE):
        row = ""
        for c in range(BOARD_SIZE):
            cell = board[r][c]
            if hide_subs and cell == SUB:
                row += WATER + " "
            else:
                row += cell + " "
        print(f"{LETTERS[r]}  {row}")
    print()

def coord_from_input(inp):
    inp = inp.strip().upper().replace(" ", "")
    if len(inp) < 2: return None
    letter, number = inp[0], inp[1:]
    if letter not in LETTERS or not number.isdigit(): return None
    row, col = LETTERS.index(letter), int(number)-1
    if 0 <= row < BOARD_SIZE and 0 <= col < BOARD_SIZE: return (row, col)
    return None

def can_place(board, r, c):
    return board[r][c] == WATER

def place_sub(board, r, c):
    board[r][c] = SUB
    return (r, c)

def remove_sub(board, coord):
    r, c = coord
    board[r][c] = WATER

def all_sunk(board):
    return all(cell != SUB for row in board for cell in row)

def take_shot(board, r, c):
    if board[r][c] == SUB:
        board[r][c] = HIT
        return "Impacto!"
    elif board[r][c] == WATER:
        board[r][c] = MISS
        return "Agua."
    elif board[r][c] in (HIT, MISS):
        return "Ya disparaste ahí."
    return "Error."

def place_all_subs(player_name):
    board = create_board()
    subs_positions = []
    print(f"\n=== {player_name}, coloca tus {NUM_SUBMARINES} submarinos ===")
    print_board(board, hide_subs=False)

    for i in range(NUM_SUBMARINES):
        placed = False
        while not placed:
            pos = input(f"Submarino {i+1} en (ejemplo A1): ")
            coord = coord_from_input(pos)
            if coord is None:
                print("Coordenada inválida.")
                continue
            r, c = coord
            if not can_place(board, r, c):
                print("Ya hay un submarino ahí.")
                continue
            subs_positions.append(place_sub(board, r, c))
            print_board(board, hide_subs=False)
            placed = True

    while True:
        move = input("¿Quieres mover un submarino? (sí/no): ").strip().lower()
        if move != "sí": break
        print("Submarinos disponibles para mover:")
        for idx, coord in enumerate(subs_positions, 1):
            print(f"{idx}. {LETTERS[coord[0]]}{coord[1]+1}")
        choice = input("Elige un número de submarino: ")
        if not choice.isdigit() or int(choice) not in range(1, NUM_SUBMARINES+1):
            print("Opción inválida.")
            continue
        idx = int(choice)-1
        remove_sub(board, subs_positions[idx])
        placed = False
        while not placed:
            pos = input(f"Nueva posición para submarino {choice} (ejemplo B2): ")
            coord = coord_from_input(pos)
            if coord is None:
                print("Coordenada inválida.")
                continue
            r, c = coord
            if not can_place(board, r, c):
                print("Ya hay un submarino ahí.")
                continue
            subs_positions[idx] = place_sub(board, r, c)
            print_board(board, hide_subs=False)
            placed = True
    return board

if __name__ == "__main__":
    board1 = place_all_subs("Jugador 1")
    input("Presiona ENTER y pasa al Jugador 2...")
    board2 = place_all_subs("Jugador 2")

    turn = 1
    while True:
        if turn == 1:
            print("\n=== Turno de Jugador 1 ===")
            print_board(board2, hide_subs=True)
            pos = input("Disparo (ejemplo B4): ")
            coord = coord_from_input(pos)
            if coord is None: 
                print("Coordenada inválida.")
                continue
            r, c = coord
            print(take_shot(board2, r, c))
            if all_sunk(board2):
                print("¡Jugador 1 gana! Hundió todos los submarinos.")
                break
            turn = 2
        else:
            print("\n=== Turno de Jugador 2 ===")
            print_board(board1, hide_subs=True)
            pos = input("Disparo (ejemplo C7): ")
            coord = coord_from_input(pos)
            if coord is None: 
                print("Coordenada inválida.")
                continue
            r, c = coord
            print(take_shot(board1, r, c))
            if all_sunk(board1):
                print("¡Jugador 2 gana! Hundió todos los submarinos.")
                break
            turn = 1